<?php$_auth = 1;require_once('module/auth.php');setPage('currs', $_currs);useLib('balance');prepareStat();$refs = array();$referalsearn = 0;$a = array(_uid());$n = $_cfg['Ref_Levels'];if ($n < 1)	$n = 1;for ($i = 0; $i < $n; $i++){	$refs[$i]['users'] = $db->fetchIDRows($db->select('Users U LEFT JOIN AddInfo ON auID=uID', 		'U.uID, U.uLogin, U.uMail, AddInfo.*, 		(SELECT SUM(dZD) FROM Deps WHERE dState>=1 and duID=U.uID) AS ZDepo,		(SELECT SUM(oSum) FROM Opers WHERE oOper=? and ouID=?d and oState=3 and oTag=U.uID) AS ZRef',		'U.uRef ?i', array('REF', _uid(), $a), 'U.uLogin'), false, 'uID');	stampTableToStr($refs[$i]['users'], 'aCTS');	$a = array_keys($refs[$i]['users']);	foreach ($refs[$i]['users'] as $row) {		$referalsearn += $row['ZRef'];	}}setPage('referalsearn', $referalsearn);$deposits = $db->fetchRows($db->select('Deps', '*', 'duID=? and dState=1', array(_uid()), '', false, 'dID'));$ondeposits = 0;if (count($deposits) > 0) {	foreach ($deposits as $row) 	{		$ondeposits += $row['dZD'];	}}setPage('ondeposits', $ondeposits);$stats = $db->fetchIDRows($db->select('Currs', 		"*, 		(SELECT SUM(oSum) FROM Opers WHERE ouID=?d AND ocID=cID AND oOper='REF' AND oState=3) AS ZREF,		(SELECT SUM(oSum) FROM Opers WHERE ouID=?d AND ocID=cID AND oOper='CALCIN' AND oState=3) AS ZCALCIN,		(SELECT SUM(oSum) FROM Opers WHERE ouID=?d AND ocID=cID AND ((cID=1 AND oOper='EXIN') OR (cID>1 AND oOper='CASHIN')) AND oState=3) AS ZIN,		(SELECT SUM(oSum) FROM Opers WHERE ouID=?d AND ocID=cID AND ((cID=1 AND oOper='EX') OR (cID>1 AND oOper='CASHOUT')) AND oState=3) AS ZOUT,		(SELECT SUM(dZD) FROM Deps WHERE duID=?d AND dcID=cID AND dState=1) AS ZINDEPO		", 		'cDisabled=0', array(_uid(), _uid(), _uid(), _uid(), _uid()), 'cID'), false, 'cID');$allearn = 0;foreach ($stats as $row) {	$allearn += $row['ZCALCIN'];}$allearn += $referalsearn;setPage('allearn', $allearn);showPage();?>